@startuml

autonumber "<b><color blue>[00]"
actor psu

box "PsuUserAgent" #LightGray
    participant "FinTechUI" as FinTechUI
    participant "TppConsentSessionUI" as TppConsentSessionUI
    participant "AspspConsentSessionUI" as AspspConsentSessionUI
end box
box "FinTechDC" #DarkSeaGreen
    participant "FinTechApi" as FinTechApi
end box
box "TppDC" #LightGray
    participant "TppBankingApi" as TppBankingApi
    participant "TppBankSearchApi" as TppBankSearchApi
    participant "TppConsentSessionApi" as TppConsentSessionApi

    participant "RedirectSessionStoreApi" as RedirectSessionStoreApi
    participant "BankingProtocol" as BankingProtocol
end box
box "AspspDC" #LightSkyBlue
	participant "AspspBankingApi" as AspspBankingApi
    participant "AspspConsentSessionApi" as AspspConsentSessionApi
end box

== Execute PSU transaction display request : call[header](body)<params> return code[header](body) ==

FinTechUI -> FinTechApi ++ : GET:FinTech-Redirect-URI[UserAgentContext,\nFinTech2TppConsentSessionCookie]()<redirectCode>
FinTechApi -> TppBankingApi ++ : GET:code2Token[UserAgentContext,\nFinTech2TppConsentSessionCookie]\n(redirectCode)<>
TppBankingApi -> RedirectSessionStoreApi ++ : redirectSession(redirectCode)
RedirectSessionStoreApi -> RedirectSessionStoreApi : loadDeryptDeleteRedirectSession\n(redirectCode):TppConsentSession
return TppConsentSession
TppBankingApi -> TppBankingApi: TppConsentSession.finTech2TppConsentSession()
return FinTech2TppConsentSession
loop FinTech2TppConsentToken.isValid()
    FinTechApi -> TppBankingApi ++ : POST:listTransactions[FinTech2TppConsentSession](requestSpec)
    TppBankingApi -> BankingProtocol ++ : listTransactions[TppConsentSession]\n(requestSpec) 
    BankingProtocol -> AspspBankingApi ++ : listTransactions[Tpp2AspspContext](AisConsent, requestSpec) 
    return 200_OK[](Transactions)
    return 200_OK[](Transactions)
    return 200_OK[](Transactions)
end
return 200_OK[](Transactions)
FinTechUI --> psu : displayTransactions()
@enduml
